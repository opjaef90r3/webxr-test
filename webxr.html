<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VR FPS Game with A-Frame</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r122/three.min.js"></script>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-physics-system@4.0.1/dist/aframe-physics-system.min.js"></script>
    <style>
        body { margin: 0; }
        canvas { display: block; }
        .hud {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-size: 24px;
            z-index: 999;
        }
    </style>
</head>
<body>
    <div class="hud">Score: <span id="score">0</span></div>
    <a-scene physics="gravity: -9.8">
        <a-assets>
            <a-asset-item id="gun-model" src="models/scene.gltf"></a-asset-item>
        </a-assets>
        
        <a-entity id="rig" position="0 1.6 0" movement-controls>
            <a-entity camera look-controls wasd-controls></a-entity>
            <!-- Right hand controller -->
            <a-entity hand-controls="hand: right; handModelStyle: lowPoly; color: #ffcccc"
                      oculus-touch-controls="hand: right" vive-controls="hand: right"
                      windows-motion-controls="hand: right" daydream-controls="hand: right"
                      gearvr-controls="hand: right" magicleap-controls="hand: right"
                      oculus-go-controls="hand: right" generic-tracked-controller-controls="hand: right">
                <a-entity gltf-model="#gun-model" scale="0.05 0.05 0.05" position="0 -0.2 -0.5"></a-entity>
                <a-entity id="muzzle" position="0 0 -1"></a-entity>
            </a-entity>
        </a-entity>

        <a-entity id="ground" geometry="primitive: plane; width: 20; height: 20" rotation="-90 0 0" material="color: #7BC8A4" static-body></a-entity>

        <a-entity id="box1" geometry="primitive: box" material="color: red" position="3 1.5 -3" dynamic-body></a-entity>
        <a-entity id="box2" geometry="primitive: box" material="color: red" position="-3 1.5 -3" dynamic-body></a-entity>
        <a-entity id="box3" geometry="primitive: box" material="color: red" position="0 1.5 -6" dynamic-body></a-entity>

        <a-sky color="#ECECEC"></a-sky>
    </a-scene>

    <script>
        let score = 0;

        function updateScore() {
            score += 1;
            document.getElementById('score').innerText = score;
        }

        document.querySelectorAll('[dynamic-body]').forEach(box => {
            box.addEventListener('hit', () => {
                updateScore();
            });
        });

        AFRAME.registerComponent('shooter', {
            init: function () {
                const el = this.el;

                el.addEventListener('controllerconnected', () => {
                    el.addEventListener('triggerdown', () => {
                        const bullet = document.createElement('a-sphere');
                        bullet.setAttribute('radius', 0.05);
                        bullet.setAttribute('color', 'yellow');
                        bullet.setAttribute('position', document.querySelector('#muzzle').object3D.position);
                        bullet.setAttribute('dynamic-body', 'shape: sphere; mass: 0.1');
                        
                        const muzzle = document.querySelector('#muzzle');
                        const direction = new THREE.Vector3();
                        muzzle.object3D.getWorldDirection(direction);
                        bullet.setAttribute('velocity', direction.multiplyScalar(-10));
                        
                        el.sceneEl.appendChild(bullet);

                        bullet.addEventListener('collide', (e) => {
                            const target = e.detail.body.el;
                            if (target && target.hasAttribute('dynamic-body')) {
                                target.emit('hit');
                                bullet.parentNode.removeChild(bullet);
                            }
                        });
                    });
                });
            }
        });

        document.querySelector('[hand-controls]').setAttribute('shooter', '');
    </script>
</body>
</html>
